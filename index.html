<script type="module">
  import { ESPLoader } from "https://esm.sh/esptool-js@0.5.7";
  import { Transport } from "https://esm.sh/esptool-js@0.5.7/webserial.js";

  const logEl = document.getElementById('log');
  const log = m => { logEl.textContent += m + "\n"; logEl.scrollTop = logEl.scrollHeight; };
  const term = { clean(){ logEl.textContent=""; }, write(d){ log(String(d)); }, writeLine(d){ log(String(d)); } };

  let port, transport, loader;

  document.getElementById('connect').onclick = async () => {
    try {
      log('ğŸ”Œ Requesting serial portâ€¦');
      port = await navigator.serial.requestPort(); // no filters!
      log('Port selected.');

      await port.open({ baudRate: 115200 });
      log('Port opened.');

      transport = new Transport(port);
      await transport.connect(115200);

      loader = new ESPLoader({ transport, baudrate: 115200, terminal: term });
      log('Connecting to bootloaderâ€¦');
      await loader.connect('default_reset', 7, true);
      log('âœ… Connected! Chip: ' + (await loader.chipName()));
    } catch (err) {
      log('âŒ Connect failed: ' + err);
    }
  };
</script>

