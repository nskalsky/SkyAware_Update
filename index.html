<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Web Serial sanity check</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 20px; }
  #log { white-space: pre-wrap; background:#111; color:#0f0; padding:10px; border-radius:6px; min-height:200px; max-height:50vh; overflow:auto; }
  button { padding:8px 12px; }
</style>
<h1>Web Serial sanity check</h1>
<button id="connect">üîå Connect</button>
<pre id="log"></pre>
<script>
  const logEl = document.getElementById('log');
  const log = m => { logEl.textContent += m + "\n"; logEl.scrollTop = logEl.scrollHeight; };
  log(`page loaded. secure=${window.isSecureContext} webSerial=${'serial' in navigator}`);

  document.getElementById('connect').addEventListener('click', async () => {
    try {
      if (!window.isSecureContext) return log('‚ùå needs HTTPS (use your GitHub Pages URL).');
      if (!('serial' in navigator)) return log('‚ùå Web Serial not available (Chrome/Edge desktop only).');

      log('connect clicked');
      const ports = await navigator.serial.getPorts();
      const port = ports[0] || await navigator.serial.requestPort();
      log('port selected: ' + (port.getInfo ? JSON.stringify(port.getInfo()) : 'ok'));

      // if already open, don't open again
      if (!port.readable || !port.writable) {
        await port.open({ baudRate: 115200 });
        log('port opened');
      } else {
        log('port already open (reusing)');
      }

      // close immediately so it‚Äôs free
      try { await port.close(); log('port closed'); } catch (e) { log('close failed: ' + e); }
    } catch (e) {
      log('‚ùå error: ' + e);
    }
  });
</script>

